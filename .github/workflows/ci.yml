name: CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  validate:
    name: Validate WordPress MCP
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
    
    - name: Validate Project Structure
      run: |
        echo "================================"
        echo "WordPress MCP Validation"
        echo "================================"
        echo
        
        # Check essential files exist
        echo "Checking core files..."
        [ -f "manifest.json" ] && echo "✅ manifest.json" || exit 1
        [ -f "README.md" ] && echo "✅ README.md" || exit 1
        [ -f "LICENSE" ] && echo "✅ LICENSE" || exit 1
        [ -d "mcp-server" ] && echo "✅ mcp-server/" || exit 1
        [ -d "wp-mcp-plugin" ] && echo "✅ wp-mcp-plugin/" || exit 1
        
        echo
        echo "Checking MCP server files..."
        [ -f "mcp-server/server.py" ] && echo "✅ server.py" || exit 1
        [ -f "mcp-server/wp_client.py" ] && echo "✅ wp_client.py" || exit 1
        [ -f "mcp-server/requirements.txt" ] && echo "✅ requirements.txt" || exit 1
        
        echo
        echo "Checking WordPress plugin..."
        [ -f "wp-mcp-plugin/wp-mcp-plugin.php" ] && echo "✅ wp-mcp-plugin.php" || exit 1
        
        echo
        echo "================================"
        echo "✅ All validations passed!"
        echo "================================"
    
    - name: Validate manifest.json
      run: |
        python3 -c "
        import json
        try:
            with open('manifest.json', 'r') as f:
                data = json.load(f)
            print('✅ manifest.json is valid JSON')
        except Exception as e:
            print(f'❌ Invalid manifest.json: {e}')
            exit(1)
        "
